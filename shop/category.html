<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Roots to Blooms â€” Shop</title>

<script src="/shop/cart.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f5f5f5;}

/* NAV */
.topnav{
  display:flex;
  justify-content:center;
  gap:14px;
  flex-wrap:wrap;
  background:#2e5d3b;
  padding:12px 0;
}
.topnav a{
  color:white;
  text-decoration:none;
  font-weight:700;
  padding:8px 16px;
  border-radius:6px;
}
.topnav a:hover{background:#4EA337;}

/* HERO */
.hero{
  height:220px;
  background:url("https://images.unsplash.com/photo-1501004318641-b39e6451bec6?q=80&w=1974") center/cover;
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
  font-size:42px;
  font-weight:700;
}

/* LAYOUT */
.container{
  max-width:1100px;
  margin:auto;
  padding:20px;
}

.filters{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-bottom:20px;
}
.filters button{
  border:none;
  padding:8px 14px;
  border-radius:20px;
  background:#d6e9da;
  cursor:pointer;
}

/* GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:18px;
}
.card{
  background:white;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
.card img{
  width:100%;
  height:180px;
  object-fit:cover;
}
.body{padding:12px;}
.name{font-weight:700;}
.latin{font-size:12px;color:#666;}
.price{margin:6px 0;}

.addBtn{
  width:100%;
  padding:10px;
  border:none;
  background:#2e5d3b;
  color:white;
  border-radius:6px;
}

.qty{
  display:flex;
  justify-content:center;
  gap:12px;
}

/* CART BUBBLE */
.cartFloating{
  position:fixed;
  bottom:18px;
  right:18px;
  background:#2e5d3b;
  color:white;
  padding:12px 18px;
  border-radius:30px;
  font-weight:700;
}
</style>
</head>

<body>

<nav class="topnav">
  <a href="/">Home</a>
  <a href="/shop/">Shop</a>
  <a href="/shop/category.html?cat=houseplants">Houseplants</a>
  <a href="/shop/category.html?cat=annuals">Annuals</a>
  <a href="/shop/category.html?cat=vegetable starters">Vegetable Starters</a>
</nav>

<div id="hero" class="hero"></div>

<div class="container">
  <div id="filters" class="filters"></div>
  <div id="grid" class="grid"></div>
</div>

<div class="cartFloating">
ðŸ›’ Cart <span id="cartCount">0</span>
</div>

<script>
const SHEET_ENDPOINT="https://script.google.com/macros/s/AKfycbxKVOYtyszNwsdNYX8iPZtYyYqDkxryKijLTNH73NqvjPWepLygI4UZ5jZYylBPytPF0A/exec";

/* ========= GET CATEGORY FROM URL ========= */

const params=new URLSearchParams(location.search);
const PAGE_CATEGORY=params.get("cat") || "houseplants";

hero.textContent = PAGE_CATEGORY.charAt(0).toUpperCase() + PAGE_CATEGORY.slice(1);

/* ========= DATA ========= */

let RAW=[],GROUPS=[],filter="all",hideSold=false;

async function load(){
  RAW=await (await fetch(SHEET_ENDPOINT)).json();
  GROUPS=buildGroups();
  renderFilters();
  render();
}

function buildGroups(){
  let map={};
  RAW.forEach(p=>{
    if(!p.categories.includes(PAGE_CATEGORY)) return;
    if(!map[p.group]) map[p.group]={base:p,vars:[]};
    map[p.group].vars.push(p);
  });
  return Object.values(map);
}

/* ========= FILTERS ========= */

function renderFilters(){
  let tags=new Set();

  GROUPS.forEach(g=>{
    g.base.categories.forEach(c=>{
      if(c!==PAGE_CATEGORY) tags.add(c);
    });
  });

  let html=`<button onclick="setFilter('all')">All</button>`;
  tags.forEach(t=>{
    html+=`<button onclick="setFilter('${t}')">${t}</button>`;
  });

  html+=`<button onclick="toggleSold()">Hide Sold</button>`;

  filters.innerHTML=html;
}

function setFilter(f){filter=f;render();}
function toggleSold(){hideSold=!hideSold;render();}

/* ========= RENDER ========= */

function render(){
  grid.innerHTML="";

  GROUPS.forEach(g=>{
    let p=g.vars[0];

    if(filter!=="all" && !p.categories.includes(filter)) return;
    if(hideSold && p.stock==0) return;

    let id=p.id;
    let qty=getQty(id);

    grid.innerHTML+=`
      <div class="card">
        <img src="${p.photo}">
        <div class="body">
          <div class="name">${p.name}</div>
          <div class="latin">${p.latin}</div>
          <div class="price">$${p.price.toFixed(2)}</div>

          ${
            p.stock==0
            ? `<div style="color:red">Sold Out</div>`
            : qty==0
            ? `<button class="addBtn" onclick="addToCart('${id}');render()">Add</button>`
            : `<div class="qty">
                <button onclick="removeFromCart('${id}');render()">âˆ’</button>
                ${qty}
                <button onclick="addToCart('${id}');render()">+</button>
              </div>`
          }
        </div>
      </div>`;
  });

  cartCount.innerText = cartCount();
}

load();
</script>

</body>
</html>
