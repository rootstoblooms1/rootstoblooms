<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Roots to Blooms â€” Vegetable Starters</title>

<script src="/shop/cart.js"></script>

<style>
body{
font-family:Arial;
margin:0;
background:#f5f5f5;
}

.hero{
height:220px;
background:url("https://images.unsplash.com/photo-1501004318641-b39e6451bec6?q=80&w=1974") center/cover;
display:flex;
align-items:center;
justify-content:center;
color:white;
font-size:42px;
font-weight:700;
}

.container{
max-width:1100px;
margin:auto;
padding:20px;
}

.filters{
display:flex;
flex-wrap:wrap;
gap:10px;
margin-bottom:20px;
}

.filters button{
border:none;
padding:8px 14px;
border-radius:20px;
background:#d6e9da;
cursor:pointer;
}

.filters button.active{
background:#2e5d3b;
color:white;
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
gap:18px;
}

.card{
background:white;
border-radius:10px;
overflow:hidden;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

.card img{
width:100%;
height:180px;
object-fit:cover;
}

.body{padding:12px;}

.name{font-weight:700;}
.latin{font-size:12px;color:#666;}
.price{margin:6px 0;}

.swatches{
display:flex;
gap:6px;
margin:6px 0;
}

.swatch{
width:18px;
height:18px;
border-radius:50%;
border:2px solid #ccc;
cursor:pointer;
}

.selected{
border:2px solid #2e5d3b;
}

.addBtn{
width:100%;
padding:10px;
border:none;
background:#2e5d3b;
color:white;
border-radius:6px;
cursor:pointer;
}

.qty{
display:flex;
justify-content:center;
gap:12px;
}

.cartFloating{
position:fixed;
bottom:18px;
right:18px;
background:#2e5d3b;
color:white;
padding:12px 18px;
border-radius:30px;
font-weight:700;
}
</style>
</head>

<body>

<div class="hero">Houseplants</div>

<div class="container">

<div class="filters" id="filters"></div>
<div id="grid" class="grid"></div>

</div>

<div class="cartFloating">
ðŸ›’ Cart <span id="cartCount">0</span>
</div>

<script>

const PAGE_CATEGORY="vegetable starters";
const SHEET_ENDPOINT="https://script.google.com/macros/s/AKfycbxKVOYtyszNwsdNYX8iPZtYyYqDkxryKijLTNH73NqvjPWepLygI4UZ5jZYylBPytPF0A/exec";

let RAW=[];
let GROUPS=[];
let filter="all";
let hideSold=false;


/* ===== Fetch from Google Sheets ===== */

async function load(){

let res=await fetch(SHEET_ENDPOINT);
RAW=await res.json();

GROUPS = buildGroups();

renderFilters();
render();
}

function buildGroups(){

let map={};

RAW.forEach(p=>{

if(!p.categories.includes(PAGE_CATEGORY)) return;

if(!map[p.group]) map[p.group]={base:p,vars:[]};
map[p.group].vars.push(p);

});

return Object.values(map);
}

/* ===== Filters ===== */

function renderFilters(){

let tags=new Set();

GROUPS.forEach(g=>{
g.base.categories.forEach(c=>{
if(c!==PAGE_CATEGORY) tags.add(c);
});
});

let html=`<button onclick="setFilter('all')" class="active">All</button>`;
tags.forEach(t=>{
html+=`<button onclick="setFilter('${t}')">${t}</button>`;
});

html+=`<button onclick="toggleSold()">Hide Sold</button>`;

document.getElementById("filters").innerHTML=html;
}

function setFilter(f){
filter=f;
render();
}

function toggleSold(){
hideSold=!hideSold;
render();
}

/* ===== Render ===== */

function render(){

let grid=document.getElementById("grid");
grid.innerHTML="";

GROUPS.forEach(g=>{

if(filter!=="all" && !g.base.categories.includes(filter)) return;

let selected=g.vars[0];
let id=selected.id;
let qty=getQty(id);

let swatches=g.vars.map(v=>`
<div class="swatch"
style="background:${v.swatch}"
onclick="selectVariant('${g.base.group}','${v.id}')">
</div>
`).join("");

grid.innerHTML+=`
<div class="card">

<img src="${selected.photo}">

<div class="body">
<div class="name">${selected.name}</div>
<div class="latin">${selected.latin}</div>
<div class="price">$${selected.price.toFixed(2)}</div>

<div class="swatches">${swatches}</div>

${selected.stock==0
? `<div style="color:red">Sold Out</div>`
: qty==0
? `<button class="addBtn" onclick="add('${id}')">Add</button>`
: `<div class="qty">
<button onclick="dec('${id}')">âˆ’</button>
${qty}
<button onclick="add('${id}')">+</button>
</div>`
}

</div>
</div>
`;
});

document.getElementById("cartCount").innerText=cartCount();
}

function add(id){ addToCart(id); render();}
function dec(id){ removeFromCart(id); render();}

load();

</script>

</body>
</html>
